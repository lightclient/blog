<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />

    <style>
      :root {
        --accent-color: #05a081;
        --accent-color-light: #82d0c0;
      }
    </style>

    <meta name="theme-color" content="#05a081" />

    
      <link rel="icon" href="https:&#x2F;&#x2F;lightclient.io&#x2F;processed_images&#x2F;444e76059742f47b00.png" />
      <link rel="apple-touch-icon" sizes="48x48" href="https:&#x2F;&#x2F;lightclient.io&#x2F;processed_images&#x2F;444e76059742f47b00.png" />
      <link rel="apple-touch-icon" sizes="72x72" href="https:&#x2F;&#x2F;lightclient.io&#x2F;processed_images&#x2F;6dfeb9b0bd094d5a00.png" />
      <link rel="apple-touch-icon" sizes="96x96" href="https:&#x2F;&#x2F;lightclient.io&#x2F;processed_images&#x2F;3959b3b31b7ae92700.png" />
      <link rel="apple-touch-icon" sizes="144x144" href="https:&#x2F;&#x2F;lightclient.io&#x2F;processed_images&#x2F;e644b27af091684500.png" />
      <link rel="apple-touch-icon" sizes="192x192" href="https:&#x2F;&#x2F;lightclient.io&#x2F;processed_images&#x2F;3344ee474c2d849c00.png" />
      <link rel="apple-touch-icon" sizes="256x256" href="https:&#x2F;&#x2F;lightclient.io&#x2F;processed_images&#x2F;d92103ca49c6bd5e00.png" />
      <link rel="apple-touch-icon" sizes="384x384" href="https:&#x2F;&#x2F;lightclient.io&#x2F;processed_images&#x2F;b8dd2689e662c9cd00.png" />
      <link rel="apple-touch-icon" sizes="512x512" href="https:&#x2F;&#x2F;lightclient.io&#x2F;processed_images&#x2F;c0d9496000275d3400.png" />
    

    <meta property="og:type" content="website">

    <meta name="twitter:card" content="summary">

    

    

    
      
        <meta name="description" content="" />
        <meta name="twitter:description" content="">
      
    

    
      <meta name="twitter:title" content="eth2 was a rollup format">
    

    

    <link rel="prefetch" href="https:&#x2F;&#x2F;lightclient.io&#x2F;processed_images&#x2F;53af5229a2f8852200.png" />

    <title>
      
        
          eth2 was a rollup format
        
      
    </title>

    
          <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
          <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/mathtex-script-type.min.js" integrity="sha384-zWYbd0NBwgTsgIdFKVprSfTh1mbMPe5Hz1X3yY4Sd1h/K1cQoUe36OGwAGz/PcDy" crossorigin="anonymous"></script>
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
          
              <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
          
    

    
    
      <link rel="stylesheet" href="https://lightclient.io/main.css">
    
    
  

  

  
    <link rel="prerender"  href="https:&#x2F;&#x2F;lightclient.io&#x2F;tags&#x2F;ethereum&#x2F;">
  

  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "NewsArticle",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://google.com/article"
      },
      "headline": "eth2 was a rollup format",
      "image": [],
      "datePublished": "2020-10-02T00:00:00+00:00",
      "dateModified": "2020-10-02T00:00:00+00:00",
      "author": {
        "@type": "Person",
        "name": "lightclient"
      },
       "publisher": {
        "@type": "Organization",
        "name": "lightclient",
        "logo": {
          "@type": "ImageObject",
          "url": "https://lightclient.io/icon.png"
        }
        
      }
      
    }
  </script>

  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        

        
        {
          
          "@type": "ListItem",
          "position": 1,
          "name": "",
          "item": "https://lightclient.io/"
        },
        
        {
          
          "@type": "ListItem",
          "position": 2,
          "name": "",
          "item": "https://lightclient.io/blog/"
        },
        
        {
          "@type": "ListItem",
          "position": 3,
          "name": "eth2 was a rollup format",
          "item": "https://lightclient.io/blog/eth2-is-a-rollup/"
        }
      ]
    }
  </script>

  </head>
  <body>
    
      <header>
        <div style="height:50px; display:flex">
          <a class="profile-icon" href="/">
            <img src="https:&#x2F;&#x2F;lightclient.io&#x2F;processed_images&#x2F;53af5229a2f8852200.png" alt="profile picture">
          </a>
          <h5 style="padding-top:6px; padding-left:1rem; font-family: sans-serif; font-size: 25px; font-weight: 200; margin:auto">lightclient<h5>
        </div>
        <nav>
          
        </nav>
      </header>
    
    <main>
    
  <div class="post-title">
    <h1>eth2 was a rollup format</h1>
    <small>
      2020.10.02
      
        - 
        <span class="tags">
          
            <a href="https:&#x2F;&#x2F;lightclient.io&#x2F;tags&#x2F;ethereum&#x2F;">ethereum</a>
          
        </span>
      
    </small>
  </div>

  <div>
    <p>When we transition to a new scaling paradigm, it is good practice to <a href="https://ethresear.ch/t/plasma-cash-was-a-transaction-format/4261">review</a>
what we've left behind.</p>
<p>The goal of this post is to convince the reader that a &quot;<a href="https://ethereum-magicians.org/t/a-rollup-centric-ethereum-roadmap/4698">rollup-centric</a>&quot;
approach is not a major departure from sharding and hopefully build a more
intuitive understanding of the (hypothetical) system as a whole.</p>
<h2 id="definition-of-an-optimistic-rollup">Definition of an Optimistic Rollup</h2>
<p>For the purpose of this post, let's specify only the most simple implementation
of an Optimistic Rollup (ORU). </p>
<p>Let an ORU have the following properties:</p>
<ol>
<li>All transaction data is submitted on-chain</li>
<li>The state root is submitted on-chain</li>
<li>The state root is accepted optimistically</li>
<li>There are some nodes that validate the ORU's transitions</li>
<li>There exists a fraud proof executor on-chain that can revert an invalid transition</li>
</ol>
<h2 id="impossibility-result-of-sharding">Impossibility Result of Sharding</h2>
<p>Before proving that eth2 sharding is just a complex system of ORUs, let's first
examine why naive sharding isn't the solution to safe scalability. The reason is
not particularly intuitive at first.</p>
<h3 id="mathematical-security-of-sharding">Mathematical Security of Sharding</h3>
<p>Let's assume there exists <a href="https://github.com/ethereum/eth2.0-specs/blob/dev/specs/phase0/beacon-chain.md#misc">a blockchain</a> with 16,384 validators, 64 shards, and 128 committee members validating each shard. There is no committee selection look-ahead and after each slot all committees are disbanded and 64 new committees are determined randomly from the overall validator set such that no validator knows what committee another validator is on. Assuming a <script type="math/tex">\frac{2}{3}</script> (i.e. 86 committee members) quorum is required to progress a shard, this implies the probability of a malicious committee chosen at random, without replacement, from the validator set with <script type="math/tex">\frac{1}{3}</script> byzantine validators is:</p>
<script type="math/tex">\operatorname{hygecdf}(\frac{2 \times 128}{3}, \, 16384, \, \frac{16384}{3}, \, 128, \, upper) = 5.5 \times 10^{-15}</script>. 
<p>It should also be noted that this parameter can be scaled up and down by
modifying the committee size to achieve the desired level of security.</p>
<p>Between the negligible chance of a malicious committee being assembled and
<a href="https://notes.ethereum.org/@vbuterin/rkhCgQteN?type=view#The-proof-of-custody-game">disincentives for being lazy</a>, this sharded system <em>should</em> inherit the
safety and liveness guarantees of it's non-sharded coordinator. But like most
real world systems, it isn't so simple. Committees are known ahead of time,
leaving room for <a href="https://eprint.iacr.org/2001/017">adaptive adversaries</a> to bribe rational participants into
performing arbitrary behavior. This is even more prevalent, if a mapping from
validator public keys to IP address can <a href="https://ethresear.ch/t/packetology-eth2-testnet-block-propagation-analysis/7561">easily be created</a>. Moreover,
verifiable voting in permissionless settings is <a href="https://hackingdistributed.com/2018/07/02/on-chain-vote-buying/">inherently vulnerable</a> to
bribery. For these reasons, the <em>real</em> security of the shards is at least an
order of magnitude worse than the theoretical values.</p>
<h3 id="sharded-data-availability-is-plasma">Sharded Data Availability is Plasma</h3>
<p>Even if the security of the shards is less than the overall protocol, we can
still ensure safety by allowing fraud proofs to revert invalid transitions.
However, without additional modifications to our hypothetical sharded chain, its
possible for an adversary to not release enough data to ever generate such a
fraud proof -- therefore forcing community intervention. We'll show how this
attack can be carried out.</p>
<p>Let's assume a naively sharded blockchain <script type="math/tex">B</script> with shards <script type="math/tex">X</script> and <script type="math/tex">Y</script>. The blockchain <script type="math/tex">B</script> runs a traditional BFT consensus algorithm which facilitates committees to operate shards <script type="math/tex">X</script> and <script type="math/tex">Y</script>, referred to as <script type="math/tex">C_X</script> and <script type="math/tex">C_Y</script> respectively. Each block in base chain <script type="math/tex">B</script> includes threshold signatures consisting of  <script type="math/tex">\frac{2}{3}</script> members from <script type="math/tex">C_X</script> and  <script type="math/tex">C_Y</script> attesting to the current block root for their shard.</p>
<p>Assuming each shard is able to process the same amount of data and transactions
per second as a non-sharded system, introducing them should provide
approximately two times the throughput. In the optimistic case this is true.</p>
<p>Now let's execute the data unavailability attack on our construction. Assume a malicious entity is able to coerce <script type="math/tex">\frac{2}{3} + 1</script> of the committee members in <script type="math/tex">C_X</script> to sign an invalid state root and to not publish the input data for that block on <script type="math/tex">X</script>. The invalid root is then included in the next block in <script type="math/tex">B</script>. There are no reasonable mechanisms that will allow <script type="math/tex">B</script> to return to a good state. We can enumerate a few options:</p>
<ol>
<li>The <script type="math/tex">\frac{1}{3} - 1</script> minority in <script type="math/tex">C_X</script> can raise an alarm on <script type="math/tex">B</script> claiming data unavailability. Unfortunately this is a non-uniquely attributable fault and therefore, <script type="math/tex">B</script> is unable to determine which group acted maliciously. This creates a free DDoS vector for a byzantine minority to exploit.</li>
<li>The rest of the nodes in the network could raise an alarm that the data was not made available. Except they can't, because only the members of <script type="math/tex">C_X</script> were watching during the fault.</li>
<li>The community will realize that a fault occurred and roll <script type="math/tex">B</script> back to its last known good state. This is bad for obvious reasons.</li>
<li>A Plasma-like mass exit from <script type="math/tex">X</script> to <script type="math/tex">B</script> is performed, incurring all its negative properties.</li>
</ol>
<p>Like in Plasma, the real problem here is data availability.</p>
<h2 id="safely-increasing-data-availability">Safely Increasing Data Availability</h2>
<p>Hopefully the pathological case above is enough to convince you that our focus
should first be directed at scaling data availability on the base layer.
Otherwise, the system will continue to be susceptible to data unavailability
attacks. </p>
<p>Traditionally, improving the data throughput on a blockchain required
<a href="https://youtu.be/l4jccXoqLGM?t=196">out-of-band agreements</a> on the minimum supported hardware / bandwidth
requirements of the system -- implying a certain acceptable blocksize. Recent
work by Mustafa Al-Bassam and Vitalik Buterin provides <a href="https://arxiv.org/abs/1809.09044">a probabilistic
mechanism</a> to ensure data availability. This work was further extended by M.
Yu et al. with their <a href="https://arxiv.org/abs/1910.01247">Coded Merkle Tree</a> accumulator, which provides
order-optimal metrics.</p>
<p>The key insight to these schemes is the relaxation of the requirement that
participants in the network download all the data. Instead, Vitalik proposed
that participants in the network randomly sample small chunks of the block to
ensure that the proposer has made the data available. The danger is that the
block proposer only needs to hide a small amount of data to carry out a data
unavailability attack. Therefore, participants must sample the block many times
in order to gain enough confidence to accept the block as available. To reduce
the number of samples, Vitalik proposed to encode the block data with a
two-dimensional Reed-Solomon encoding. </p>
<p>In this construction, the block chunked into <script type="math/tex">N</script> shares and then encoded, generating <script type="math/tex">M</script> shares where <em>any</em> <script type="math/tex">N</script> out of <script type="math/tex">M</script> shares can reconstruct the block. Assuming <script type="math/tex">2N = M</script>, then the block proposer would need to hide <script type="math/tex">\frac{1}{2}</script> of the block in order to successfully execute a data unavailability attack. The Coded Merkle Tree offers a similar construction, but with <script type="math/tex">O(b)</script> decoding overhead and  <script type="math/tex">O(1)</script> hash commitment instead of  <script type="math/tex">O(b^{1.5})</script> decoding overhead and  <script type="math/tex">O(\sqrt{b})</script> hash commitment offered by 2D Reed Solomon encoding, where <script type="math/tex">b</script> is the size of the block in bytes.</p>
<p>For a more detailed explanation of this technique, please see this
<a href="https://github.com/ethereum/research/wiki/A-note-on-data-availability-and-erasure-coding">note</a>.</p>
<h2 id="shards-are-rollups">Shards are Rollups</h2>
<p>The sharding design in eth2 obfuscates the fact that they are actually just ORUs
to the beacon chain. If the focus is shifted from distributed processing to the
ordered data availability layer, it becomes clearer.</p>
<p><img src="https://i.imgur.com/wbmrrMG.png" alt="Figure 1" /></p>
<p>In the diagram above, the validator set has four roles:</p>
<ol>
<li>Validate and execute the beacon chain</li>
<li>Sample the data made available by the shards</li>
<li>Serve on shard committees</li>
<li>Submit fraud proofs for invalid state transitions</li>
</ol>
<p>Since we've made the assumption that the data will either i) be available or ii)
the chain will fork to last point where data was available, a fraud proof will
either be able to be constructed or the system will attribute the lack of data
availability to the shard quorum who signed the block and rollback the
transition.</p>
<h3 id="by-definition-eth2-is-an-oru">By Definition, Eth2 is an ORU</h3>
<p>At this point, we should be able to prove that the shards are in fact rollups --
given our earlier definition of an ORU:</p>
<p><strong>1. All transaction data is submitted on-chain</strong></p>
<p>Shard block data is pooled into the <a href="https://github.com/ethereum/eth2.0-specs/pull/1566">data availability layer</a>, verified by the
entire network probabilistically.</p>
<p><strong>2. A state root is submitted on-chain</strong></p>
<p>Shard committee attest to shard state roots which are included in <a href="https://github.com/ethereum/eth2.0-specs/blob/dev/specs/phase1/beacon-chain.md#extended-beaconblockbody">beacon chain
blocks</a>.</p>
<p><strong>3. A state root is accepted optimistically</strong></p>
<p>The beacon chain <a href="https://github.com/ethereum/eth2.0-specs/blob/dev/specs/phase1/beacon-chain.md#validate_attestation">optimistically accepts</a> shard committee attestations
without additional validation.</p>
<p><strong>4. There are some nodes that validate the ORU's transitions</strong></p>
<p>The shard committees <a href="https://github.com/ethereum/eth2.0-specs/blob/ee-draft/specs/phase1/shard-transition.md#honest-committee-member-behavior">validate the shard transitions</a>.</p>
<p><strong>5. There exists a fraud proof executor on-chain that can revert an invalid transition</strong></p>
<p>The beacon chain supports <a href="https://github.com/ethereum/eth2.0-specs/blob/6a1813b1d64ef06d59d5d2a16b8ea21b2ad72887/specs/phase1/shard-transition.md#fraud-proofs">shard transition fraud proofs</a>.</p>
<h2 id="deconstructing-eth2">Deconstructing Eth2</h2>
<p>Now that we've shown the uncanny similarity between eth2 and a system of ORUs,
how can we use this information to better understand the design of the overall
system? Let's explore a few design decisions made in eth2 through the lens of a
system of ORUs:</p>
<h3 id="data-throughput">Data Throughput</h3>
<p>In the current design, the system's data throughput is tightly coupled to shard
mechanics. </p>
<p>An approach that could be taken here is to treat data availability checks as a
first class citizen in the protocol. This will allow the data layer to be
optimized independently, and for the execution layer to have more granular
control over hardware requirements.</p>
<p>For example, instead of shards eth2 could offer 64 <em>data hubs</em> and an ORU
contract on the beacon chain. The ORU contract could allow for rollups to decide
on a leader election mechanism, how many hubs they wish to post data to, if they
wish to atomically bind themselves to another rollup (e.g. if one rolls back,
they also roll back). The more hubs in use, the higher the hardware requirements
to validate the rollup would have to be.</p>
<p>The system described above would be a strict superset of the current sharding
design. Not only could there still be 64 protocol defined shards, there could be
other rollups with their own characteristics built on top of the secure data
layer that are not bound to the fate of the protocol shards.</p>
<h3 id="rollback-minimization">Rollback Minimization</h3>
<p>In a simple ORU, the elected leader has the power to submit an invalid state transition. Although this isn't a safety violation, because a fraud proof will revert the transition, it does disrupt the progress of the rollup. In isolation, this disruption is typically not worth the cost for an adversary. However, in eth2, cross-shard communication makes this problem particularly thorny. Shards on slot <script type="math/tex">N</script> have the expectation that they can build off of all other shard states at <script type="math/tex">N-1</script>. If some shard <script type="math/tex">S_i</script> crosslinks an invalid state transition, there is no reasonable way to revert its side effects on shards <script type="math/tex">S_j</script> where <script type="math/tex">0 \leq j \leq 64; i \neq j</script> other than a unilateral rollback.</p>
<p>To avoid such a catastrophic event, there must be mechanisms in place to avoid such rollbacks. Two obvious ones are shard committees and custody bit checks. As demonstrated in the section above regarding the mathematical properties of sharding, the chances of corrupting <script type="math/tex">\frac{2}{3}</script> of a shard committee are low -- even taking into account the various attack vectors. The custody bit helps ensure that honest validators aren't duped into signing an invalid transition out of laziness.</p>
<p>By viewing these mechanisms as <em>deterrents</em> against invalid transitions, instead of mechanisms upholding the safety of the system, we have the ability to choose parameters that may make more practical sense while achieving the same effect. For example, reducing the shard committee size to 64 members will still yield a probability of <script type="math/tex">3.1 \times 10^{-8}</script> of randomly sampling a byzantine committee. But from a practical networking and signature aggregation point of view, it could significantly alleviate some of the burden.</p>
<h2 id="a-rollup-centric-ethereum-roadmap">A Rollup-Centric Ethereum Roadmap</h2>
<p>This post was originally written during SBC20 when I begun to fully grasp the
similarities between eth2 and ORUs. In light of Vitalik's <a href="https://ethereum-magicians.org/t/a-rollup-centric-ethereum-roadmap/4698">post</a>, I decided
to finally publish this post in agreement of the &quot;rollup-centric&quot; approach for
the future of Ethereum. Although, as shown in this post, a &quot;rollup-centric&quot;
approach is not a major departure from where we were already heading -- just a
superset. The <a href="https://ethresear.ch/t/cross-shard-defi-composability/6268">problems</a> we faced with sharding are isomorphic to problems
we'll face when integrating cross-rollup communication. This means that the
large body of work that has already begun on the topic can continue, mostly
uninterrupted.</p>
<p>The rollup-centric roadmap will reduce the protocol complexity that would be
required to shard execution. It will allow us to develop complex, shard-like
rollup mechanisms iteratively. This will enfranchise a much wider set of
developers to contribute different rollup formats and allow existing core
developers and researchers to focus on building a robust data-availability
layer. </p>
<p>One could say that the path to a fully-functional eth2 has <a href="https://ethresear.ch/t/open-research-questions-for-phases-0-to-2/5871">never</a> been
clearer.</p>
<p>--</p>
<p><em>If you found this interesting and want to discuss the topic further, contact
me on twitter <a href="https://twitter.com/lightclients">@lightclients</a>. I'm also
looking to connect outstanding researchers &amp; engineers to impactful projects.
DM me if you'd like help.</em></p>

  </div>

  <hr class="footer-rule" />

  

  <div class="related-container">

    

    

  </div>


    </main>
  </body>
</html>
